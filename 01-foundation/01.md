# Lab 1: üèóÔ∏è Go Project Setup

Welcome to your first lab! Time to build the foundation of your Chinook data pipeline. 

## üéØ Objectives
- Set up a proper Go project structure
- Initialize Go modules correctly
- Create your first Go application
- Understand Go's project layout conventions

## üõ†Ô∏è Tasks

### Step 1: Initialize Your Go Module
```bash
# Navigate to your workshop directory
cd /Users/rob/@Sync/bufstuff/protobuf/workshop

# Initialize Go module (use your actual GitHub username if you have one)
go mod init github.com/chinook/data-pipeline

# Verify it worked
cat go.mod
```

### Step 2: Create Project Structure
```bash
# Create the standard Go project layout
mkdir -p {cmd/producer,cmd/consumer,internal/customer,internal/database,pkg/proto,api/customer/v1}

# Create main application files
touch cmd/producer/main.go
touch cmd/consumer/main.go
touch internal/customer/service.go
touch internal/database/sqlite.go
```

### Step 3: Write Your First Go Service
Create `internal/customer/service.go`:

```go
package customer

import (
	"context"
	"fmt"
)

// Customer represents a Chinook customer
type Customer struct {
	ID    int64  `json:"id"`
	Name  string `json:"name"`
	Email string `json:"email"`
}

// Service handles customer operations
type Service struct {
	// We'll add database connection later
}

// NewService creates a new customer service
func NewService() *Service {
	return &Service{}
}

// GetCustomer retrieves a customer by ID
func (s *Service) GetCustomer(ctx context.Context, id int64) (*Customer, error) {
	// TODO: Replace with real database query
	if id <= 0 {
		return nil, fmt.Errorf("invalid customer ID: %d", id)
	}
	
	// Dummy customer for now
	return &Customer{
		ID:    id,
		Name:  "John Doe",
		Email: "john@chinook.com",
	}, nil
}

// ListCustomers returns all customers
func (s *Service) ListCustomers(ctx context.Context) ([]*Customer, error) {
	// TODO: Replace with real database query
	return []*Customer{
		{ID: 1, Name: "Alice Smith", Email: "alice@example.com"},
		{ID: 2, Name: "Bob Jones", Email: "bob@example.com"},
	}, nil
}
```

### Step 4: Create Your Producer Application
Create `cmd/producer/main.go`:

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/chinook/data-pipeline/internal/customer"
)

func main() {
	fmt.Println("üè≠ Chinook Data Producer Starting...")

	// Create customer service
	customerSvc := customer.NewService()

	// Get a customer (we'll make this real later)
	ctx := context.Background()
	cust, err := customerSvc.GetCustomer(ctx, 1)
	if err != nil {
		log.Fatalf("Failed to get customer: %v", err)
	}

	fmt.Printf("Retrieved customer: %+v\n", cust)

	// List all customers
	customers, err := customerSvc.ListCustomers(ctx)
	if err != nil {
		log.Fatalf("Failed to list customers: %v", err)
	}

	fmt.Printf("Found %d customers\n", len(customers))
	for _, c := range customers {
		fmt.Printf("  - %s (%s)\n", c.Name, c.Email)
	}

	fmt.Println("‚úÖ Producer completed successfully!")
}
```

### Step 5: Test Your Setup
```bash
# Run your application
go run cmd/producer/main.go

# You should see output like:
# üè≠ Chinook Data Producer Starting...
# Retrieved customer: &{ID:1 Name:John Doe Email:john@chinook.com}
# Found 2 customers
#   - Alice Smith (alice@example.com)
#   - Bob Jones (bob@example.com)
# ‚úÖ Producer completed successfully!
```

## üí• Deliberate Failure: Error Handling Practice

Let's break something to learn error handling!

### Break It:
```go
// In cmd/producer/main.go, try this:
cust, err := customerSvc.GetCustomer(ctx, -1) // Invalid ID!
```

### Fix It:
The error should be handled gracefully. Notice how Go forces you to handle errors explicitly - no hidden exceptions!

## üîç Further Exploration

1. **Add input validation** to the Customer struct
2. **Create a consumer application** that reads the same data
3. **Add logging** using the standard library or a package like logrus
4. **Experiment with interfaces** - create a CustomerRepository interface

## ‚úÖ Victory Conditions

- [ ] Go module initialized and working
- [ ] Project structure follows Go conventions
- [ ] Applications compile and run without errors
- [ ] You understand basic Go error handling
- [ ] You can navigate the project structure confidently

## üö® Common Issues & Solutions

**Issue**: Import errors
**Solution**: Make sure your module name matches what you use in imports

**Issue**: "go: cannot find main module"
**Solution**: Make sure you're in the directory with go.mod

**Issue**: Compilation errors
**Solution**: Run `go mod tidy` to fix missing dependencies

---

**Next**: Head to `lab02/` to create your first protobuf schema! üéØ